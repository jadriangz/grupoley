<?xml version="1.0" encoding="UTF-8" ?>

<odoo>
    <data>
        <template id="l10n_mx_edi_addenda_casa_ley" name="Addenda Casa Ley">
            <t t-set="sale_model" t-value="'sale_line_ids' in record.invoice_line_ids._fields"/>
            <t t-set="sale_id"
               t-value="record.mapped('invoice_line_ids.sale_line_ids.order_id') if sale_model else False"/>
            <cley:ADDENDA_CLEY xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                               VERSION="1.0"
                               xmlns:cley="http://servicios.casaley.com.mx/factura_electronica"
                               CORREO="Facturacion@laguacamaya.com"
                               xsi:SchemaLocation="http://servicios.casaley.com.mx/factura_electronica http://servicios.casaley.com.mx/factura_electronica/XSD_ADDENDA_CASALEY.xsd">
                <cley:MERCADERIAS>
                    <cley:PA t-att-DESCUENTO="8" t-att-NO_REMISION="7" PROVEEDOR-SAP="000R104704"
                             t-att-FECHA_ENTRADA="7" t-att-NUMERO_ENTRADA="5" t-att-CENTRO="1" t-att-PROVEEDOR="8"/>
                    <t t-set="i" t-value="1"/>
                    <t t-foreach="sale_id.order_line" t-as="o">
                        <t t-set="i" t-value="i+1"/>
                        <cley:DETALLE t-att-DESCUENTO="o.disccount" t-att-TASA_IEPS="1" t-att-IMPUESTO_IEPS="4"
                                      t-att-TASA_IVA="6" t-att-IMPUESTO_IVA="o.tax_id.amount"
                                      t-att-PRECIO_LISTA="o.product_id.list_price" t-att-UMC="o.product_id.uom_id"
                                      t-att-CANTIDAD="o.qty_invoiced" t-att-RENGLON="i">
                            <cley:CODBAR_ARTICULO t-att-COD_BAR="o.product_id.barcode"/>
                            <cley:CLEY_ARTICULO t-att-COD_ARTICULO="0"/>
                        </cley:DETALLE>
                    </t>
                </cley:MERCADERIAS>
            </cley:ADDENDA_CLEY>
        </template>

        <record id="l10n_mx_edi_addenda_casa_ley" model="ir.ui.view">
            <field name="l10n_mx_edi_addenda_flag">True</field>
        </record>
    </data>
</odoo>